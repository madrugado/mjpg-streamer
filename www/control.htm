<html>
  <head>
    <link type="text/css" rel="stylesheet" href="JQuerySpinBtn.css" />
	  <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="JQuerySpinBtn.js"></script>
  </head>
  <body>
  	<table id="control"></table>
    </div>
    <script type="text/javascript"> 
        function setControl(controlId, value) {
          $.get('/?action=command&command='+ controlId + '&value=' + value);
        }

        function setControl_bool(controlId, value) {
          if (value == false)
            setControl(controlId, 0);
          else
            setControl(controlId, 1);
        }

        function setControl_string(controlId, string, minlength) {
          if (string.length < minlength) {
            alert("The input string has to be least"+minlength+" caracters!");
            return;
          }
          $.get('/?action=command&command='+ controlId + '&value=' + value, function(data){
             alert("Data Loaded: " + data);
           });
        }

        $.getJSON("controls.json",
          function(data) {
            $.each(data.controls, function(i,item){
              $("<tr/>").attr("id", "tr-"+item.id).appendTo("#control");

              // BUTTON controls does not have a label 
              if (item.type == "BUTTON") {
                $("<td/>").appendTo("#tr-"+item.id);
              } else {
                if (item.type == "CTRL_CLASS") {
                  $("<td/>").text(item.name).attr("style", "font-weight:bold;").appendTo("#tr-"+item.id);
                  return;
                } else {
                  $("<td/>").text(item.name).appendTo("#tr-"+item.id);
                }
              }

              $("<td/>").attr("id", "td-ctrl-"+item.id).appendTo("#tr-"+item.id);
              if((item.type == "INTEGER") || (item.type == "INTEGER64")) {
                var options = {
		                min: item.min,							// Set lower limit or null for no limit.
		                max: item.max,						// Set upper limit or null for no limit.
		                step: item.step,						// Set increment size.
	                }
                $("<input/>")
                  .attr("value", item.value)
                  .attr("id", "spinbox-"+item.id)
                  .SpinButton(options)
                  .change(function() {setControl(item.id, $(this).val());})
                  .appendTo("#td-ctrl-"+item.id);
              } else if (item.type == "BOOLEAN") {
                if (item.value == "1")
                  $("<input/>")
                    .attr("type", "checkbox")
                    .attr("checked", "checked")
                    .change(function(){setControl(item.id, ($(this).attr("checked")?1:0));})
                    .appendTo("#td-ctrl-"+item.id);
                else
                  $("<input/>")
                    .attr("type", "checkbox")
                    .change(function(){setControl(item.id, ($(this).attr("checked")?1:0));})
                    .appendTo("#td-ctrl-"+item.id);
              } else if (item.type == "STRING") {
                  $("<input/>").attr("value", item.value).appendTo("#td-ctrl-"+item.id);
              } else if (item.type == "MENU") {
                $("<select/>")
                  .attr("name", "select-"+item.id)
                  .attr("id", "menu-"+item.id)
                  .attr("style", "width: 100%;")
                  .change(function(){setControl(item.id, $(this).val());})
                  .appendTo("#td-ctrl-"+item.id);
                $.each(item.menu, function(val, text) {
                    if (item.value == val) {
                      $("#menu-"+item.id).append($('<option></option>').attr("selected", "selected").val(val).html(text));
                    } else {
                      $("#menu-"+item.id).append($('<option></option>').val(val).html(text));
                    }
                });
              } else if (item.type == "BUTTON") {
                $("<button/>")
                  .attr("type", "button")
                  .attr("style", "width: 100%; height: 100%;")
                  .text(item.name)
                  .click(function(){setControl(item.id, 0);})
                  .appendTo("#td-ctrl-"+item.id);
              } else if (item.type == "STRING") {
                $("<input/>")
                    .attr("type", "text")
                    .attr("maxlength", item.max)
                    .change(function(){setControl_string(item.id, $(this).text(), item.min);})
                    .appendTo("#td-ctrl-"+item.id);
              } else {
                 alert("Unknown control type: "+item.type);
              }
            });
            $("<tr/>").attr("id", "tr-status").appendTo("#control");
            $("<td/>").appendTo("#tr-status");
            $("<td/>").attr("id", "td-status").appendTo("#tr-status");
          }
        );
    </script>
  </body>
</html>
